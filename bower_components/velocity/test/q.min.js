!function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function s(e){return function(){return a.apply(e,arguments)}}function m(e){return e===Object(e)}function g(e){return"[object StopIteration]"===v(e)||e instanceof y}function x(t,n){if(e&&n.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(b)){for(var i=[],r=n;r;r=r.source)r.stack&&i.unshift(r.stack);i.unshift(t.stack);var o=i.join("\n"+b+"\n");t.stack=w(o)}}function w(e){for(var t=e.split("\n"),n=[],i=0;i<t.length;++i){var r=t[i];C(r)||T(r)||!r||n.push(r)}return n.join("\n")}function T(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function S(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(e);return i?[i[1],Number(i[2])]:void 0}function C(e){var t=S(e);if(!t)return!1;var r=t[0],o=t[1];return r===i&&o>=n&&ae>=o}function k(){if(e)try{throw new Error}catch(t){var n=t.stack.split("\n"),r=n[0].indexOf("@")>0?n[1]:n[2],o=S(r);if(!o)return;return i=o[0],o[1]}}function E(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}function _(e){return P(e)?e:F(e)?Y(e):X(e)}function j(){function f(e){i=e,a.source=e,u(t,function(t,n){o(function(){e.promiseDispatch.apply(e,n)})},void 0),t=void 0,n=void 0}var i,t=[],n=[],r=d(j.prototype),a=d(D.prototype);if(a.promiseDispatch=function(e,r,a){var s=l(arguments);t?(t.push(s),"when"===r&&a[1]&&n.push(a[1])):o(function(){i.promiseDispatch.apply(i,s)})},a.valueOf=function(){if(t)return a;var e=O(i);return P(e)&&(i=e),e},a.inspect=function(){return i?i.inspect():{state:"pending"}},_.longStackSupport&&e)try{throw new Error}catch(s){a.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return r.promise=a,r.resolve=function(e){i||f(_(e))},r.fulfill=function(e){i||f(X(e))},r.reject=function(e){i||f($(e))},r.notify=function(e){i||u(n,function(t,n){o(function(){n(e)})},void 0)},r}function N(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=j();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function A(e){return N(function(t,n){for(var i=0,r=e.length;r>i;i++)_(e[i]).then(t,n)})}function D(e,t,n){void 0===t&&(t=function(e){return $(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=d(D.prototype);if(i.promiseDispatch=function(n,r,o){var a;try{a=e[r]?e[r].apply(i,o):t.call(i,r,o)}catch(s){a=$(s)}n&&n(a)},i.inspect=n,n){var r=n();"rejected"===r.state&&(i.exception=r.reason),i.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?i:e.value}}return i}function L(e,t,n,i){return _(e).then(t,n,i)}function O(e){if(P(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function P(e){return m(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function F(e){return m(e)&&"function"==typeof e.then}function H(e){return P(e)&&"pending"===e.inspect().state}function R(e){return!P(e)||"fulfilled"===e.inspect().state}function M(e){return P(e)&&"rejected"===e.inspect().state}function V(){q.length=0,I.length=0,B||(B=!0)}function z(e,t){B&&(I.push(e),t&&"undefined"!=typeof t.stack?q.push(t.stack):q.push("(no stack) "+t))}function W(e){if(B){var t=f(I,e);-1!==t&&(I.splice(t,1),q.splice(t,1))}}function $(e){var t=D({when:function(t){return t&&W(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return z(t,e),t}function X(e){return D({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return h(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function Y(e){var t=j();return o(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function U(e){return D({isDef:function(){}},function(t,n){return ee(e,t,n)},function(){return _(e).inspect()})}function G(e,t,n){return _(e).spread(t,n)}function Q(e){return function(){function t(e,t){var o;if("undefined"==typeof StopIteration){try{o=n[e](t)}catch(a){return $(a)}return o.done?_(o.value):L(o.value,i,r)}try{o=n[e](t)}catch(a){return g(a)?_(a.value):$(a)}return L(o,i,r)}var n=e.apply(this,arguments),i=t.bind(t,"next"),r=t.bind(t,"throw");return i()}}function Z(e){_.done(_.async(e)())}function K(e){throw new y(e)}function J(e){return function(){return G([this,te(arguments)],function(t,n){return e.apply(t,n)})}}function ee(e,t,n){return _(e).dispatch(t,n)}function te(e){return L(e,function(e){var t=0,n=j();return u(e,function(i,r,o){var a;P(r)&&"fulfilled"===(a=r.inspect()).state?e[o]=a.value:(++t,L(r,function(i){e[o]=i,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:o,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function ne(e){return L(e,function(e){return e=c(e,_),L(te(c(e,function(e){return L(e,r,r)})),function(){return e})})}function ie(e){return _(e).allSettled()}function re(e,t){return _(e).then(void 0,void 0,t)}function oe(e,t){return _(e).nodeify(t)}var e=!1;try{throw new Error}catch(t){e=!!t.stack}var i,y,n=k(),r=function(){},o=function(){function a(){for(;e.next;){e=e.next;var t=e.task;e.task=void 0;var i=e.domain;i&&(e.domain=void 0,i.enter());try{t()}catch(o){if(r)throw i&&i.exit(),setTimeout(a,0),i&&i.enter(),o;setTimeout(function(){throw o},0)}i&&i.exit()}n=!1}var e={task:void 0,next:null},t=e,n=!1,i=void 0,r=!1;if(o=function(e){t=t.next={task:e,domain:r&&process.domain,next:null},n||(n=!0,i())},"undefined"!=typeof process&&process.nextTick)r=!0,i=function(){process.nextTick(a)};else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){i=l,s.port1.onmessage=a,a()};var l=function(){s.port2.postMessage(0)};i=function(){setTimeout(a,0),l()}}else i=function(){setTimeout(a,0)};return o}(),a=Function.call,l=s(Array.prototype.slice),u=s(Array.prototype.reduce||function(e,t){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(t=e(t,this[n],n));return t}),f=s(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),c=s(Array.prototype.map||function(e,t){var n=this,i=[];return u(n,function(r,o,a){i.push(e.call(t,o,a,n))},void 0),i}),d=Object.create||function(e){function t(){}return t.prototype=e,new t},p=s(Object.prototype.hasOwnProperty),h=Object.keys||function(e){var t=[];for(var n in e)p(e,n)&&t.push(n);return t},v=s(Object.prototype.toString);y="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var b="From previous event:";_.resolve=_,_.nextTick=o,_.longStackSupport=!1,_.defer=j,j.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(l(arguments,1)):e.resolve(n)}},_.Promise=N,_.promise=N,N.race=A,N.all=te,N.reject=$,N.resolve=_,_.passByCopy=function(e){return e},D.prototype.passByCopy=function(){return this},_.join=function(e,t){return _(e).join(t)},D.prototype.join=function(e){return _([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},_.race=A,D.prototype.race=function(){return this.then(_.race)},_.makePromise=D,D.prototype.toString=function(){return"[object Promise]"},D.prototype.then=function(e,t,n){function s(t){try{return"function"==typeof e?e(t):t}catch(n){return $(n)}}function l(e){if("function"==typeof t){x(e,i);try{return t(e)}catch(n){return $(n)}}return $(e)}function u(e){return"function"==typeof n?n(e):e}var i=this,r=j(),a=!1;return o(function(){i.promiseDispatch(function(e){a||(a=!0,r.resolve(s(e)))},"when",[function(e){a||(a=!0,r.resolve(l(e)))}])}),i.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=u(e)}catch(i){if(n=!0,!_.onerror)throw i;_.onerror(i)}n||r.notify(t)}]),r.promise},_.when=L,D.prototype.thenResolve=function(e){return this.then(function(){return e})},_.thenResolve=function(e,t){return _(e).thenResolve(t)},D.prototype.thenReject=function(e){return this.then(function(){throw e})},_.thenReject=function(e,t){return _(e).thenReject(t)},_.nearer=O,_.isPromise=P,_.isPromiseAlike=F,_.isPending=H,D.prototype.isPending=function(){return"pending"===this.inspect().state},_.isFulfilled=R,D.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},_.isRejected=M,D.prototype.isRejected=function(){return"rejected"===this.inspect().state};var q=[],I=[],B=!0;_.resetUnhandledRejections=V,_.getUnhandledReasons=function(){return q.slice()},_.stopUnhandledRejectionTracking=function(){V(),B=!1},V(),_.reject=$,_.fulfill=X,_.master=U,_.spread=G,D.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},_.async=Q,_.spawn=Z,_["return"]=K,_.promised=J,_.dispatch=ee,D.prototype.dispatch=function(e,t){var n=this,i=j();return o(function(){n.promiseDispatch(i.resolve,e,t)}),i.promise},_.get=function(e,t){return _(e).dispatch("get",[t])},D.prototype.get=function(e){return this.dispatch("get",[e])},_.set=function(e,t,n){return _(e).dispatch("set",[t,n])},D.prototype.set=function(e,t){return this.dispatch("set",[e,t])},_.del=_["delete"]=function(e,t){return _(e).dispatch("delete",[t])},D.prototype.del=D.prototype["delete"]=function(e){return this.dispatch("delete",[e])},_.mapply=_.post=function(e,t,n){return _(e).dispatch("post",[t,n])},D.prototype.mapply=D.prototype.post=function(e,t){return this.dispatch("post",[e,t])},_.send=_.mcall=_.invoke=function(e,t){return _(e).dispatch("post",[t,l(arguments,2)])},D.prototype.send=D.prototype.mcall=D.prototype.invoke=function(e){return this.dispatch("post",[e,l(arguments,1)])},_.fapply=function(e,t){return _(e).dispatch("apply",[void 0,t])},D.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},_["try"]=_.fcall=function(e){return _(e).dispatch("apply",[void 0,l(arguments,1)])},D.prototype.fcall=function(){return this.dispatch("apply",[void 0,l(arguments)])},_.fbind=function(e){var t=_(e),n=l(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(l(arguments))])}},D.prototype.fbind=function(){var e=this,t=l(arguments);return function(){return e.dispatch("apply",[this,t.concat(l(arguments))])}},_.keys=function(e){return _(e).dispatch("keys",[])},D.prototype.keys=function(){return this.dispatch("keys",[])},_.all=te,D.prototype.all=function(){return te(this)},_.allResolved=E(ne,"allResolved","allSettled"),D.prototype.allResolved=function(){return ne(this)},_.allSettled=ie,D.prototype.allSettled=function(){return this.then(function(e){return te(c(e,function(e){function t(){return e.inspect()}return e=_(e),e.then(t,t)}))})},_.fail=_["catch"]=function(e,t){return _(e).then(void 0,t)},D.prototype.fail=D.prototype["catch"]=function(e){return this.then(void 0,e)},_.progress=re,D.prototype.progress=function(e){return this.then(void 0,void 0,e)},_.fin=_["finally"]=function(e,t){return _(e)["finally"](t)},D.prototype.fin=D.prototype["finally"]=function(e){return e=_(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},_.done=function(e,t,n,i){return _(e).done(t,n,i)},D.prototype.done=function(e,t,n){var i=function(e){o(function(){if(x(e,r),!_.onerror)throw e;_.onerror(e)})},r=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),r.then(void 0,i)},_.timeout=function(e,t,n){return _(e).timeout(t,n)},D.prototype.timeout=function(e,t){var n=j(),i=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(i),n.resolve(e)},function(e){clearTimeout(i),n.reject(e)},n.notify),n.promise},_.delay=function(e,t){return void 0===t&&(t=e,e=void 0),_(e).delay(t)},D.prototype.delay=function(e){return this.then(function(t){var n=j();return setTimeout(function(){n.resolve(t)},e),n.promise})},_.nfapply=function(e,t){return _(e).nfapply(t)},D.prototype.nfapply=function(e){var t=j(),n=l(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},_.nfcall=function(e){var t=l(arguments,1);return _(e).nfapply(t)},D.prototype.nfcall=function(){var e=l(arguments),t=j();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},_.nfbind=_.denodeify=function(e){var t=l(arguments,1);return function(){var n=t.concat(l(arguments)),i=j();return n.push(i.makeNodeResolver()),_(e).fapply(n).fail(i.reject),i.promise}},D.prototype.nfbind=D.prototype.denodeify=function(){var e=l(arguments);return e.unshift(this),_.denodeify.apply(void 0,e)},_.nbind=function(e,t){var n=l(arguments,2);return function(){function o(){return e.apply(t,arguments)}var i=n.concat(l(arguments)),r=j();return i.push(r.makeNodeResolver()),_(o).fapply(i).fail(r.reject),r.promise}},D.prototype.nbind=function(){var e=l(arguments,0);return e.unshift(this),_.nbind.apply(void 0,e)},_.nmapply=_.npost=function(e,t,n){return _(e).npost(t,n)},D.prototype.nmapply=D.prototype.npost=function(e,t){var n=l(t||[]),i=j();return n.push(i.makeNodeResolver()),this.dispatch("post",[e,n]).fail(i.reject),i.promise},_.nsend=_.nmcall=_.ninvoke=function(e,t){var n=l(arguments,2),i=j();return n.push(i.makeNodeResolver()),_(e).dispatch("post",[t,n]).fail(i.reject),i.promise},D.prototype.nsend=D.prototype.nmcall=D.prototype.ninvoke=function(e){var t=l(arguments,1),n=j();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},_.nodeify=oe,D.prototype.nodeify=function(e){return e?void this.then(function(t){o(function(){e(null,t)})},function(t){o(function(){e(t)})}):this};var ae=k();return _});